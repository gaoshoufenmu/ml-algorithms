#### b更新

每次迭代更新了$$\alpha_1, \alpha_2$$ 后，还需要更新$$b$$ 的值，因为上一篇文章[SMO\_SVM](/svm/smosvm.md)中最后那个\(14\)方程组中出现了$$b$$ 这个变量，前面[Soft](/svm/smo.md)这篇文章的最后分析了根据非边界点（$$0 \lt \alpha_i \lt C$$ ）来更新$$b$$ 值，已知，

$$b = y_i - \sum_{j =1}^m y_j \alpha_j \mathbf x_j \mathbf x_i, \quad \forall i \in [m], 0 \lt \alpha_i \lt C$$

所以，

* 当$$0 \lt \alpha_i \lt C$$，

$$\begin{align} b_1 & = y_1 - y_1 \alpha_1 K_{11} - y_2 \alpha_2 K_{12} - \sum_{j = 3}^m y_j \alpha_j K_{1j} \\ & = y_1 - y_1 \alpha_1 K_{11} - y_2 \alpha_2 K_{12} +  y_1 \alpha_1^{(p)} K_{11} + y_2 \alpha_2^{(p)} K_{12} + b -( \sum_{j=1}^m y_j \alpha_j^{(p)} K_{1j} + b) \\ & = (y_1 - f_1) - y_1 \alpha_1 K_{11} - y_2 \alpha_2 K_{12} +  y_1 \alpha_1^{(p)} K_{11} + y_2 \alpha_2^{(p)} K_{12} + b \\ & = - E_1 - y_1 K_{11} (\alpha_1 - \alpha_1^{(p)}) - y_2 K_{12} (\alpha_2 - \alpha_2^{(p)}) + b \end{align}$$        \(15\)

使用

$$b^{new} = b_1$$

来更新

注：

有些文章上面给出的$$b$$ 的更新方程与上面不一样，而是如下方程所示，

$$b_1 = E_1 + y_1 K_{11} (\alpha_1 - \alpha_1^{(p)}) + y_2 K_{22} (\alpha_2 - \alpha_2^{(p)}) + b$$

然而这里说明一下，其实这两者是一致的，因为那些文章中输出函数为$$f(\mathbf x) = \mathbf {wx} - b$$，与我们的输出函数仅$$b$$ 前面的符号相反，如果用$$-b$$ 代替$$b$$ 代入上式，得$$-b_1 = E_1 + y_1 K_{11} (\alpha_1 - \alpha_1^{(p)}) + y_2 K_{22} (\alpha_2 - \alpha_2^{(p)})  - b$$，与\(15\)相同。

* 当$$ 0 \lt \alpha_2 \lt C$$，

同理，

$$b_1 = - E_2 - y_1K_{12}(\alpha_1 - \alpha_1^{(p)}) - y_2 K_{22} (\alpha_2 - \alpha_2^{(p)}) + b$$

使用

$$b^{new} = b_2$$

来更新

* 当$$ 0 \lt \alpha_1, \alpha_2 \lt C$$，

此时，$$b_1 = b_2$$

使用

$$b^{new} = b_1, \quad or \quad b^{new} = b_2$$

来更新

* 当$$\alpha_1 , \alpha_2 = 0 \ | \ \alpha_1, \alpha_2 = C $$，并且$$L \neq H$$，

此时$$b_1$$ 和$$b_2$$ 之间所有值都满足KKT条件，都可以作为$$b$$ 的更新值，一般取

$$b^{new} = \frac {\alpha_1 + \alpha_2} 2$$

来更新

#### $$\mathbf w$$ 更新

因为$$\mathbf w = \sum_{i=1}^m y_i \alpha_i \mathbf x_i$$，所以$$\mathbf w$$ 的更新就很直接了，如下，

$$\mathbf w^{new} = \mathbf w + y_1(\alpha_1 - \alpha_1^{(p)}) \mathbf x_1 + y_2 (\alpha_2 - \alpha_2^{(p)}) \mathbf x_2$$

#### 启发式选择拉格朗日乘子

需要选择两个拉格朗日乘子，第一个乘子的选择对应外层循环，也就是说，外层循环是对第一个乘子进行迭代的。

第一个乘子$$\alpha_1$$ 的选择方法为，先对整个样本集进行遍历，对于不满足KKT条件的样本点，均需要进行优化（与第二个乘子对应的样本点联合起来使用上面介绍的方法优化，第二个乘子的样本点如何选择，这里先忽略，后文会介绍），这一遍优化完成后，然后对非边界条件（$$0 \lt \alpha_i \lt C$$）的样本点遍历，如果不满足KKT条件，则也作为第一个乘子的样本点去优化，这一遍优化完成后，重复此遍优化，即，对非边界条件（$$0 \lt \alpha_i \lt C$$）且不满足KKT条件的样本子集 **重复 **遍历，直至所有非边界条件的样本点均在 $$\epsilon$$ 误差范围内满足KKT条件。

然后，由于对非边界条件的样本点优化肯定也影响到那些边界条件（$$\alpha_i = 0  \ or \ \alpha_i = C$$）的样本点，所以，重复上一段文字描述的过程，直至所有样本点在 $$ \epsilon$$ 误差范围内满足KKT条件。

上面介绍了第一个乘子如何选择，然而选择了第一个乘子后，还必须紧接着选择相应的第二个乘子，否则上面的每一次优化更新都无法进行。SMO希望每一次更新步子跨大一点，根据$$\alpha_2$$ 的更新公式，很显然就是希望$$|E_1 - E_2|$$ 越大越好，所以第二个乘子的选择依据是使得$$|E_1 - E_2|$$ 值最大的那个样本点。具体来说，对所有非边界点的样本点，如果$$E_1 >0$$ ，那么选择$$E_2$$ 最小的那个样本点，如果$$E_1>0$$ ，那么选择$$E_2$$ 最大的那个样本点，如果$$E_1=0$$ ，选择$$|E_2|$$ 最大的那个样本点。

* 注：KKT条件为[Soft](/svm/smo.md)文章中的\(KKT\)式。



